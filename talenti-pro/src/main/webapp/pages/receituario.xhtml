<!DOCTYPE html>
<ui:composition xmlns:h="jakarta.faces.html"
	xmlns:f="jakarta.faces.core" xmlns:ui="jakarta.faces.facelets"
	xmlns:p="http://primefaces.org/ui"
	template="/templates/template-sistema.xhtml">



<ui:define name="content">
<h:form id="formBuscaPaciente">

	    <p:panel header="PASSO 1º - SELECIONE O PACIENTE" style="max-width:600px;margin:auto;">
	        <h:panelGrid columns="2" style="width:100%" cellpadding="5">
	            <p:outputLabel for="nomeBusca" value="Nome:" />
	            <p:inputText id="nomeBusca" value="#{receituarioManagedBean.filtroNomePaciente}"
	                         placeholder="Digite o nome do paciente" style="width:100%" />
	        </h:panelGrid>
	
	        <p:commandButton value="Pesquisar" icon="pi pi-search"
	                         action="#{receituarioManagedBean.pesquisarPaciente}"
	                         process="@form"
	                         update="formPaciente:tabela msgs"
	                         style="margin-top:10px;width:100%;" />
	    </p:panel>
	
	</h:form>

	       <h:form id="formPaciente">
				<p:dataTable id="tabela" value="#{receituarioManagedBean.pacientes}" 
				    var="p"
				    paginator="true"
				    lazy="true"
				    rows="5"
				    rowsPerPageTemplate="5,10,20,50"
				    paginatorAlwaysVisible="true"
				    paginatorPosition="top"
					style="max-width:600px;margin:auto;">
					<p:column headerText="ID">#{p.id}</p:column>
					<p:column headerText="Nome">#{p.nome}</p:column>
					<p:column headerText="CPF">#{p.cpf}</p:column>
					<p:column headerText="Selecionar">
					<p:commandButton icon="pi pi-pencil"
					    action="#{receituarioManagedBean.addPaciente(p)}"
					    update=":msgs :formReceitaMedicamento"
					    process="@this"
					    immediate="true"
					    styleClass="rounded-button ui-button-success"
					    title="Selecionar" />
					
					</p:column>
				</p:dataTable>
			</h:form>

<p:separator style="margin:50px 0" />			
			
<h:form id="formBuscaMedicamento">

	    <p:panel header="PASSO 2º - SELECIONE O MEDICAMENTO" style="max-width:600px;margin:auto;">
	        <h:panelGrid columns="2" style="width:100%" cellpadding="5">
	
	            <p:outputLabel for="nomeBusca" value="Nome:" />
	            <p:inputText id="nomeBusca" value="#{receituarioManagedBean.filtroNomeMedicamento}"
	                         placeholder="Digite o nome do medicamento" style="width:100%" />
	        </h:panelGrid>
	
	        <p:commandButton value="Pesquisar" icon="pi pi-search"
	                         action="#{receituarioManagedBean.pesquisarMedicamento}"
	                         process="@form"
	                         update="formMedicamento:tabela msgs"
	                         style="margin-top:10px;width:100%;" />
	    </p:panel>
	
	</h:form>	

	<h:form id="formMedicamento">

				<p:dataTable id="tabela" value="#{receituarioManagedBean.medicamentos}" 
				    var="p"
				    paginator="true"
				    lazy="true"
				    rows="5"
				    rowsPerPageTemplate="5,10,20,50"
				    paginatorAlwaysVisible="true"
				    paginatorPosition="top"
					style="max-width:600px;margin:auto;">
					<p:column headerText="ID">#{p.id}</p:column>
					<p:column headerText="Nome">#{p.nome}</p:column>
					<p:column headerText="Selecionar">
					<p:commandButton icon="pi pi-pencil"
					    action="#{receituarioManagedBean.addMedicamento(p)}"
					    update=":msgs :formReceitaMedicamento"
					    process="@this"
					    immediate="true"
					    styleClass="rounded-button ui-button-success"
					    title="Selecionar" />
					</p:column>
				</p:dataTable>
			</h:form>		

			<p:separator style="margin:30px 0" />

           <h:form id="formReceitaMedicamento">
				<p:panel header="PASSO 3º - MONTE A PRESCRIÇÃO"
					style="max-width:600px;margin:auto;">

 				<h:panelGrid columns="2" style="width:100%" cellpadding="5">
					
					<p:outputLabel  value="Paciente:" />
					<p:inputText value="#{receituarioManagedBean.paciente.nome}" style="width:100%"
						readonly="true" required="true" />
						
					<p:outputLabel value="Medicamento:" />	
					<p:inputText value="#{receituarioManagedBean.medicamento.nome}"
						placeholder="Nome" style="width:100%" 
						required="true" readonly="true" />
						
					<p:outputLabel value="Observação:" />	
					<p:inputText value="#{receituarioManagedBean.obs}"
						placeholder="Observação" style="width:100%" />	
						
					<p:outputLabel value="Quantidade:" />	
					<p:inputNumber  
					  decimalPlaces="2"
                       minValue="0.5"
                       thousandSeparator="."
                       decimalSeparator="," 
                       value="#{receituarioManagedBean.quantidade}"
						 style="width:100%" />		
						

				</h:panelGrid>	
				<h:panelGroup layout="block" style="display:flex; gap:10px; margin-top:10px;">
				    <p:commandButton value="Adicionar" 
				                     action="#{receituarioManagedBean.addReceitaMedicamento}"
				                     update="tabelaPrescricao :msgs"
				                     icon="pi pi-save"
				                     style="flex:1;" />
				</h:panelGroup>
				</p:panel>

			<p:dataTable id="tabelaPrescricao" value="#{receituarioManagedBean.receituario.medicamentos}" 
				    var="p"
					style="max-width:600px;margin:auto;">
					<p:column headerText="Medicamento">#{p.medicamento.nome}</p:column>
					<p:column headerText="Quantidade">#{p.quantidade}</p:column>
					<p:column headerText="Remover">
					<p:commandButton icon="pi pi-trash"
					    action="#{receituarioManagedBean.removerMedicamento(p)}"
					    update="tabelaPrescricao :msgs "
					    process="@this"
					    immediate="true"
					     styleClass="ui-button-danger"
					    title="Remover" />
					</p:column>
				</p:dataTable>
				
	    <p:panel  style="max-width:600px;margin:auto;">
	        <h:panelGrid columns="1" style="width:100%">
				             <p:commandButton value="FINALIZAR"
	                         action="#{receituarioManagedBean.salvarReceitar}"
	                         process="@form"
	                         update="tabelaPrescricao tabelaRcetasCad :msgs"
	                         style="margin-top:10px;width:100%;height: 50px; background: green; font-size: 25px;" />
			</h:panelGrid>            
				</p:panel>
			</h:form>
			<p:separator style="margin:50px 0" />	

 <p:panel header="RECEITAS CADASTRADAS" style="max-width:600px;margin:auto;">
			<p:dataTable id="tabelaRcetasCad" value="#{receituarioManagedBean.receitas}" 
				    var="p"
				    paginator="true"
				    lazy="true"
				    rows="5"
				    rowsPerPageTemplate="5,10,20,50"
				    paginatorAlwaysVisible="true"
				    paginatorPosition="top"
					style="max-width:600px;margin:auto;">
					<p:column headerText="ID">#{p.id}</p:column>
					<p:column headerText="Nome">#{p.paciente.nome}</p:column>

				</p:dataTable>			
           </p:panel> 			
          <p:separator style="margin:50px 0" />	
	</ui:define>
</ui:composition>
